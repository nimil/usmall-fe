<!--pages/detail/detail.wxml-->
<view class="container">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-container" wx:if="{{loading}}">
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- å¸–å­å†…å®¹ -->
  <view class="post-content" wx:if="{{!loading && post.id}}">
    <!-- å¸–å­å¤´éƒ¨ä¿¡æ¯ -->
    <view class="post-header">
      <view class="author-info">
        <image class="author-avatar" src="{{post.author.avatar}}" mode="aspectFill" />
        <view class="author-details">
          <view class="author-name">
            <text>{{post.author.nickname}}</text>
            <text wx:if="{{post.author.isVerified}}" class="verified-badge">âœ“</text>
          </view>
          <view class="author-level">Lv.{{post.author.level}}</view>
        </view>
      </view>
      <view class="post-meta">
        <text class="post-time">{{post.createdAt}}</text>
        <view class="post-category" wx:if="{{post.categoryName}}">{{post.categoryName}}</view>
      </view>
    </view>

    <!-- å¸–å­ä¸»ä½“å†…å®¹ -->
    <view class="post-body">
      <text class="post-title" wx:if="{{post.title}}">{{post.title}}</text>
      <text class="post-text">{{post.content}}</text>
      
      <!-- å›¾ç‰‡å±•ç¤º -->
      <view class="post-images" wx:if="{{post.images && post.images.length > 0}}">
        <image class="post-image" 
               wx:for="{{post.images}}" 
               wx:key="*this"
               src="{{item}}" 
               mode="widthFix"
               bindtap="onImagePreview"
               data-url="{{item}}" />
      </view>

      <!-- æ ‡ç­¾ -->
      <view class="post-tags" wx:if="{{post.tags && post.tags.length > 0}}">
        <text class="tag" wx:for="{{post.tags}}" wx:key="*this">{{item}}</text>
      </view>
    </view>

    <!-- äº’åŠ¨æŒ‰é’®åŒºåŸŸ -->
    <view class="post-interaction">
      <view class="interaction-actions">
        <view class="action-item {{post.isLiked ? 'liked' : ''}}" bindtap="onLike">
          <text class="action-icon">{{post.isLiked ? 'â¤ï¸' : 'ğŸ¤'}}</text>
          <text class="action-text">{{post.stats.likes || 0}}</text>
        </view>
        <button class="action-item share-btn" open-type="share">
          <text class="action-icon">ğŸ“¤</text>
          <text class="action-text">åˆ†äº«</text>
        </button>
      </view>
      
      <!-- æµè§ˆé‡æ˜¾ç¤º -->
      <view class="view-count">
        <text class="view-icon">ğŸ‘ï¸</text>
        <text class="view-text">{{post.stats.views || 0}}</text>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{!loading && !post.id}}">
    <text class="empty-icon">ğŸ“­</text>
    <text class="empty-text">å¸–å­ä¸å­˜åœ¨æˆ–å·²è¢«åˆ é™¤</text>
  </view>

  <!-- è¯„è®ºåŒºåŸŸ -->
  <view class="comments-section" wx:if="{{!loading && post.id}}">
    <view class="section-header">
      <text class="section-title">è¯„è®º ({{comments.length}})</text>
    </view>
    
    <!-- è¯„è®ºåŠ è½½çŠ¶æ€ -->
    <view class="loading-container" wx:if="{{commentsLoading}}">
      <text class="loading-text">åŠ è½½è¯„è®ºä¸­...</text>
    </view>
    
    <view class="comment-list" wx:if="{{!commentsLoading}}">
      <view class="comment-item" wx:for="{{comments}}" wx:key="id">
        <image class="comment-avatar" src="{{item.author.avatar}}" mode="aspectFill" />
        <view class="comment-content">
          <view class="comment-header">
            <text class="comment-author">{{item.author.nickname}}</text>
            <text class="comment-time">{{item.createdAt}}</text>
          </view>
          <text class="comment-text">{{item.content}}</text>
          <view class="comment-actions">
            <text class="comment-action" bindtap="onLikeComment" data-id="{{item.id}}">
              ğŸ‘ {{item.likes || 0}}
            </text>
            <text class="comment-action" bindtap="onReplyComment" data-id="{{item.id}}">
              å›å¤
            </text>
          </view>
        </view>
      </view>
      
      <!-- è¯„è®ºç©ºçŠ¶æ€ -->
      <view class="empty-comments" wx:if="{{!commentsLoading && comments.length === 0}}">
        <text class="empty-icon">ğŸ’¬</text>
        <text class="empty-text">æš‚æ— è¯„è®ºï¼Œå¿«æ¥æŠ¢æ²™å‘å§ï¼</text>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨å®‰å…¨åŒºåŸŸ -->
  <view class="safe-area-bottom"></view>
</view>

<!-- è¯„è®ºè¾“å…¥æ¡† -->
<view class="comment-input-container">
  <view class="comment-input-bar">
    <input class="comment-input" 
           placeholder="å†™ä¸‹ä½ çš„è¯„è®º..." 
           value="{{commentText}}"
           bindinput="onCommentInput"
           focus="{{commentFocus}}" />
    <text class="send-btn {{commentText ? 'active' : ''}}" bindtap="onSendComment">å‘é€</text>
  </view>
</view> 