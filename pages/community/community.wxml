<!--pages/community/community.wxml-->
<view class="container">
  <!-- 分类标签 -->
  <view class="category-tabs">
    <!-- 加载状态 -->
    <view class="loading-container" wx:if="{{topicsLoading}}">
      <text class="loading-text">加载话题中...</text>
    </view>
    
    <scroll-view class="tabs-scroll" scroll-x="true" wx:if="{{!topicsLoading}}">
      <view class="tab-item {{currentTab === index ? 'active' : ''}}" 
            wx:for="{{categories}}" 
            wx:key="id"
            bindtap="onTabChange"
            data-index="{{index}}">
        <text class="tab-icon">{{item.icon}}</text>
        <text class="tab-name">{{item.name}}</text>
        <text class="tab-count" wx:if="{{item.postCount}}">({{item.postCount}})</text>
      </view>
    </scroll-view>
  </view>

  <!-- 帖子列表 -->
  <view class="post-list">
    <view class="post-item card" wx:for="{{currentPosts}}" wx:key="id" bindtap="onPostTap" data-post="{{item}}">
      <!-- 帖子头部 -->
      <view class="post-header">
        <view class="author-info">
          <image class="author-avatar" src="{{item.author.avatar}}" mode="aspectFill" />
          <view class="author-details">
            <view class="author-name">
              <text>{{item.author.nickname}}</text>
              <text wx:if="{{item.author.isVerified}}" class="verified-badge">✓</text>
            </view>
            <view class="author-level">Lv.{{item.author.level}}</view>
          </view>
        </view>
        <view class="post-time">{{item.createdAt}}</view>
      </view>

      <!-- 帖子内容 -->
      <view class="post-content">
        <view class="post-title">{{item.title}}</view>
        <view class="post-excerpt">{{item.excerpt}}</view>
        
        <!-- 帖子图片 -->
        <view class="post-images" wx:if="{{item.images && item.images.length > 0}}">
          <image 
            wx:for="{{item.images}}" 
            wx:for-item="img" 
            wx:key="*this" 
            class="post-image" 
            src="{{img}}" 
            mode="aspectFill"
            bindtap="onImageTap"
            data-images="{{item.images}}"
            data-current="{{img}}"
          />
        </view>

        <!-- 帖子标签 -->
        <view class="post-tags" wx:if="{{item.tags && item.tags.length > 0}}">
          <text wx:for="{{item.tags}}" wx:for-item="tag" wx:key="*this" class="tag">{{tag}}</text>
        </view>
      </view>

      <!-- 帖子统计 -->
      <view class="post-stats">
        <view class="stat-item" bindtap="onLikeTap" data-post="{{item}}">
          <text class="stat-icon {{item.isLiked ? 'liked' : ''}}">{{item.isLiked ? '❤️' : '🤍'}}</text>
          <text class="stat-count">{{item.stats.likes}}</text>
        </view>
        <view class="stat-item" bindtap="onCommentTap" data-post="{{item}}">
          <text class="stat-icon">💬</text>
          <text class="stat-count">{{item.stats.comments}}</text>
        </view>
        <view class="stat-item">
          <text class="stat-icon">👁️</text>
          <text class="stat-count">{{item.stats.views}}</text>
        </view>
        <view class="stat-item" bindtap="onShareTap" data-post="{{item}}">
          <text class="stat-icon">📤</text>
          <text class="stat-count">{{item.stats.shares}}</text>
        </view>
      </view>
    </view>

    <!-- 加载更多 -->
    <view class="load-more" wx:if="{{hasMore}}">
      <text wx:if="{{loading}}" class="loading-text">加载中...</text>
      <text wx:else class="load-more-text">上拉加载更多</text>
    </view>
    
    <!-- 没有更多数据 -->
    <view class="no-more" wx:if="{{!hasMore && currentPosts.length > 0}}">
      <text class="no-more-text">没有更多内容了</text>
    </view>

    <!-- 空状态 -->
    <view class="empty-state" wx:if="{{!loading && currentPosts.length === 0}}">
      <text class="empty-icon">📭</text>
      <text class="empty-text">暂无内容</text>
    </view>
  </view>



  <!-- 悬浮发布按钮 -->
  <view class="fab" bindtap="onPostCreate">
    <text class="fab-icon">+</text>
  </view>
</view> 