<!--pages/community/community.wxml-->
<view class="container">
  <!-- åˆ†ç±»æ ‡ç­¾ -->
  <view class="category-tabs">
    <!-- åŠ è½½çŠ¶æ€ -->
    <view class="loading-container" wx:if="{{topicsLoading}}">
      <text class="loading-text">åŠ è½½è¯é¢˜ä¸­...</text>
    </view>
    
    <scroll-view class="tabs-scroll" scroll-x="true" wx:if="{{!topicsLoading}}">
      <view class="tab-item {{currentTab === index ? 'active' : ''}}" 
            wx:for="{{categories}}" 
            wx:key="id"
            bindtap="onTabChange"
            data-index="{{index}}">
        <text class="tab-icon">{{item.icon}}</text>
        <text class="tab-name">{{item.name}}</text>
        <text class="tab-count" wx:if="{{item.postCount}}">({{item.postCount}})</text>
      </view>
    </scroll-view>
  </view>

  <!-- å¸–å­åˆ—è¡¨ -->
  <view class="post-list">
    <view class="post-item card" wx:for="{{currentPosts}}" wx:key="id" bindtap="onPostTap" data-post="{{item}}">
      <!-- å¸–å­å¤´éƒ¨ -->
      <view class="post-header">
        <view class="author-info">
          <image class="author-avatar" src="{{item.author.avatar}}" mode="aspectFill" />
          <view class="author-details">
            <view class="author-name">
              <text>{{item.author.nickname}}</text>
              <text wx:if="{{item.author.isVerified}}" class="verified-badge">âœ“</text>
            </view>
            <view class="author-level">Lv.{{item.author.level}}</view>
          </view>
        </view>
        <view class="post-time">{{item.createdAt}}</view>
      </view>

      <!-- å¸–å­å†…å®¹ -->
      <view class="post-content">
        <view class="post-title">{{item.title}}</view>
        <view class="post-excerpt">{{item.excerpt}}</view>
        
        <!-- å¸–å­å›¾ç‰‡ -->
        <view class="post-images" wx:if="{{item.images && item.images.length > 0}}">
          <image 
            wx:for="{{item.images}}" 
            wx:for-item="img" 
            wx:key="*this" 
            class="post-image" 
            src="{{img}}" 
            mode="aspectFill"
            bindtap="onImageTap"
            data-images="{{item.images}}"
            data-current="{{img}}"
          />
        </view>

        <!-- å¸–å­æ ‡ç­¾ -->
        <view class="post-tags" wx:if="{{item.tags && item.tags.length > 0}}">
          <text wx:for="{{item.tags}}" wx:for-item="tag" wx:key="*this" class="tag">{{tag}}</text>
        </view>
      </view>

      <!-- å¸–å­ç»Ÿè®¡ -->
      <view class="post-stats">
        <view class="stat-item" bindtap="onLikeTap" data-post="{{item}}">
          <text class="stat-icon {{item.isLiked ? 'liked' : ''}}">{{item.isLiked ? 'â¤ï¸' : 'ğŸ¤'}}</text>
          <text class="stat-count">{{item.stats.likes}}</text>
        </view>
        <view class="stat-item" bindtap="onCommentTap" data-post="{{item}}">
          <text class="stat-icon">ğŸ’¬</text>
          <text class="stat-count">{{item.stats.comments}}</text>
        </view>
        <view class="stat-item">
          <text class="stat-icon">ğŸ‘ï¸</text>
          <text class="stat-count">{{item.stats.views}}</text>
        </view>
        <view class="stat-item" bindtap="onShareTap" data-post="{{item}}">
          <text class="stat-icon">ğŸ“¤</text>
          <text class="stat-count">{{item.stats.shares}}</text>
        </view>
      </view>
    </view>

    <!-- åŠ è½½æ›´å¤š -->
    <view class="load-more" wx:if="{{hasMore}}">
      <text wx:if="{{loading}}" class="loading-text">åŠ è½½ä¸­...</text>
      <text wx:else class="load-more-text">ä¸Šæ‹‰åŠ è½½æ›´å¤š</text>
    </view>
    
    <!-- æ²¡æœ‰æ›´å¤šæ•°æ® -->
    <view class="no-more" wx:if="{{!hasMore && currentPosts.length > 0}}">
      <text class="no-more-text">æ²¡æœ‰æ›´å¤šå†…å®¹äº†</text>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{!loading && currentPosts.length === 0}}">
      <text class="empty-icon">ğŸ“­</text>
      <text class="empty-text">æš‚æ— å†…å®¹</text>
    </view>
  </view>



  <!-- æ‚¬æµ®å‘å¸ƒæŒ‰é’® -->
  <view class="fab" bindtap="onPostCreate">
    <text class="fab-icon">+</text>
  </view>
</view> 